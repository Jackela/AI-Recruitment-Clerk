<div class="create-job-container">
  <!-- Fantasy Header Section -->
  <header class="page-header" role="banner">
    <div class="header-content">
      <button
        type="button"
        class="btn-back"
        (click)="onCancel()"
        [disabled]="creating$ | async"
        [attr.aria-label]="'common.back' | translate"
      >
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
          <path d="M19 12H5M12 19l-7-7 7-7"/>
        </svg>
        <span>{{ 'common.back' | translate }}</span>
      </button>
      <div class="header-text">
        <h1 id="page-title" class="page-title">{{ 'jobs.createJob.title' | translate }}</h1>
        <p class="page-subtitle" role="doc-subtitle">创建新的招聘职位并开始接收候选人</p>
      </div>
    </div>
  </header>

  <!-- Error Banner -->
  <div *ngIf="error$ | async as error" class="error-banner alert-danger" role="alert" aria-live="assertive">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
      <circle cx="12" cy="12" r="10"></circle>
      <line x1="12" y1="8" x2="12" y2="12"></line>
      <line x1="12" y1="16" x2="12.01" y2="16"></line>
    </svg>
    <span>{{ error }}</span>
    <button
      type="button"
      class="error-close"
      (click)="onClearError()"
      [attr.aria-label]="'common.close' | translate"
    >
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </button>
  </div>

  <!-- Create Job Form Bento Card -->
  <article class="create-job-bento-card" role="main" aria-labelledby="form-heading">
    <div class="card-header">
      <div class="card-icon" aria-hidden="true">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
          <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
        </svg>
      </div>
      <h2 id="form-heading" class="card-title">{{ 'jobs.createJob.information' | translate }}</h2>
    </div>
    <div class="card-body">
      <form [formGroup]="createJobForm" (ngSubmit)="onSubmit()" novalidate>
        <!-- Job Title Field -->
        <div class="form-field">
          <label for="jobTitle" class="field-label">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <polyline points="14,2 14,8 20,8"></polyline>
            </svg>
            {{ 'jobs.createJob.jobTitle.label' | translate }}
            <span class="required-indicator" aria-label="必填" title="必填">*</span>
          </label>
          <input
            type="text"
            id="jobTitle"
            class="field-input"
            formControlName="jobTitle"
            [class.invalid]="hasFieldError('jobTitle')"
            [placeholder]="'jobs.createJob.jobTitle.placeholder' | translate"
            maxlength="100"
            [attr.aria-invalid]="hasFieldError('jobTitle')"
            [attr.aria-describedby]="hasFieldError('jobTitle') ? 'jobTitle-error' : 'jobTitle-hint'"
          />
          <div *ngIf="getFieldError('jobTitle') as jobTitleError" class="field-error invalid-feedback" id="jobTitle-error" role="alert">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="12" y1="8" x2="12" y2="12"></line>
              <line x1="12" y1="16" x2="12.01" y2="16"></line>
            </svg>
            {{ jobTitleError.key | translate: jobTitleError.params }}
          </div>
          <div class="field-hint" id="jobTitle-hint">
            {{ 'jobs.createJob.jobTitle.hint' | translate }}
          </div>
        </div>

        <!-- Job Description Field -->
        <div class="form-field">
          <label for="jdText" class="field-label">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <polyline points="14,2 14,8 20,8"></polyline>
              <line x1="16" y1="13" x2="8" y2="13"></line>
              <line x1="16" y1="17" x2="8" y2="17"></line>
              <polyline points="10,9 9,9 8,9"></polyline>
            </svg>
            {{ 'jobs.createJob.jobDescription.label' | translate }}
            <span class="required-indicator" aria-label="必填" title="必填">*</span>
          </label>
          <div class="textarea-wrapper">
            <textarea
              id="jdText"
              class="field-textarea"
              formControlName="jdText"
              [class.invalid]="hasFieldError('jdText')"
              [placeholder]="'jobs.createJob.jobDescription.placeholder' | translate"
              rows="12"
              maxlength="5000"
              [attr.aria-invalid]="hasFieldError('jdText')"
              [attr.aria-describedby]="hasFieldError('jdText') ? 'jdText-error' : 'jdText-hint'"
            ></textarea>
            <div class="character-count" aria-live="polite" aria-atomic="true">
              <span class="count-current">{{ jdText?.value?.length || 0 }}</span>
              <span class="count-divider"> / </span>
              <span class="count-max">5000</span>
            </div>
          </div>
          <div *ngIf="getFieldError('jdText') as jdTextError" class="field-error invalid-feedback" id="jdText-error" role="alert">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="12" y1="8" x2="12" y2="12"></line>
              <line x1="12" y1="16" x2="12.01" y2="16"></line>
            </svg>
            {{ jdTextError.key | translate: jdTextError.params }}
          </div>
          <div class="field-hint" id="jdText-hint">
            <p class="hint-title">{{ 'jobs.createJob.jobDescription.hint' | translate }}</p>
            <ul class="requirements-list">
              <li>
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
                  <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
                {{ 'jobs.createJob.jobDescription.requirements.skills' | translate }}
              </li>
              <li>
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
                  <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
                {{ 'jobs.createJob.jobDescription.requirements.experience' | translate }}
              </li>
              <li>
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
                  <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
                {{ 'jobs.createJob.jobDescription.requirements.education' | translate }}
              </li>
              <li>
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
                  <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
                {{ 'jobs.createJob.jobDescription.requirements.other' | translate }}
              </li>
            </ul>
          </div>
        </div>

        <!-- Form Actions -->
        <div class="form-actions">
          <button
            type="button"
            class="btn-secondary"
            (click)="onCancel()"
            [disabled]="creating$ | async"
            [attr.aria-label]="'jobs.createJob.actions.cancel' | translate"
          >
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
            <span>{{ 'jobs.createJob.actions.cancel' | translate }}</span>
          </button>
          <button
            type="submit"
            class="btn-primary"
            [disabled]="!createJobForm.valid || (creating$ | async)"
            [attr.aria-label]="(creating$ | async) ? ('jobs.createJob.actions.creating' | translate) : ('jobs.createJob.actions.create' | translate)"
          >
            <svg *ngIf="(creating$ | async) === false" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
              <path d="M12 5v14M5 12h14"></path>
            </svg>
            <span *ngIf="creating$ | async" class="spinner" aria-hidden="true"></span>
            <span>{{ (creating$ | async) ? ('jobs.createJob.actions.creating' | translate) : ('jobs.createJob.actions.create' | translate) }}</span>
          </button>
        </div>
      </form>
    </div>
  </article>

  <!-- Progress Tracking Bento Card -->
  <article *ngIf="shouldShowProgress()" class="progress-tracking-bento-card" role="status" aria-live="polite" aria-atomic="false">
    <div class="card-header">
      <div class="card-icon" aria-hidden="true">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <circle cx="12" cy="12" r="10"></circle>
          <polyline points="12 6 12 12 16 14"></polyline>
        </svg>
      </div>
      <h2 class="card-title">{{ 'jobs.createJob.progress.title' | translate }}</h2>
    </div>
    <div class="card-body">
      <!-- Progress Bar Section -->
      <div class="progress-section">
        <div class="progress-header">
          <span class="progress-label">{{ getCurrentStep() }}</span>
          <span class="progress-percentage" aria-live="polite">{{ getProgressPercentage() }}%</span>
        </div>
        <div class="progress-bar-wrapper">
          <div class="progress-bar-track">
            <div 
              class="progress-bar-fill" 
              [style.width.%]="getProgressPercentage()"
              [attr.aria-valuenow]="getProgressPercentage()"
              [attr.aria-valuemin]="0"
              [attr.aria-valuemax]="100"
              [attr.aria-label]="'Progress: ' + getProgressPercentage() + '%'"
              role="progressbar"
            ></div>
          </div>
        </div>
      </div>

      <!-- Status Message Section -->
      <div class="status-section">
        <div class="status-message">
          <div class="status-icon" aria-hidden="true">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <polyline points="23 4 23 10 17 10"></polyline>
              <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
            </svg>
          </div>
          <p class="status-text" aria-live="polite">{{ getProgressMessage() }}</p>
        </div>
        
        <!-- Estimated Time Remaining -->
        <div *ngIf="getEstimatedTimeRemaining()" class="time-remaining">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
            <circle cx="12" cy="12" r="10"></circle>
            <polyline points="12 6 12 12 16 14"></polyline>
          </svg>
          <span class="time-label">{{ 'jobs.createJob.progress.estimatedTimeRemaining' | translate }}:</span>
          <span class="time-value" aria-live="polite">{{ getEstimatedTimeRemaining() }} min</span>
        </div>
      </div>

      <!-- Progress Steps Indicator -->
      <div class="steps-indicator" role="list" aria-label="处理步骤">
        <div class="step" 
             *ngFor="let step of getProgressSteps(); let i = index"
             [class.completed]="step.completed"
             [class.active]="step.active"
             role="listitem"
             [attr.aria-current]="step.active ? 'step' : null">
          <div class="step-circle">
            <svg *ngIf="step.completed" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
              <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
            <span *ngIf="!step.completed" aria-hidden="true">{{ i + 1 }}</span>
          </div>
          <div class="step-content">
            <div class="step-label">{{ step.label }}</div>
          </div>
        </div>
      </div>
    </div>
  </article>
</div>
