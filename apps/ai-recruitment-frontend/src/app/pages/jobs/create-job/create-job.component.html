<div class="create-job-container">
  <!-- Header -->
  <div class="page-header">
    <div class="d-flex align-items-center">
      <button
        type="button"
        class="btn btn-secondary mr-3"
        (click)="onCancel()"
        [disabled]="creating$ | async"
      >
        ‚Üê {{ 'common.back' | translate }}
      </button>
      <h2 class="page-title">{{ 'jobs.createJob.title' | translate }}</h2>
    </div>
  </div>

  <!-- Error Message -->
  <div *ngIf="error$ | async as error" class="alert alert-danger mb-3">
    <div class="d-flex justify-content-between align-items-center">
      <span>{{ error }}</span>
      <button
        type="button"
        class="btn-close"
        (click)="onClearError()"
        [attr.aria-label]="'common.close' | translate"
      >
        √ó
      </button>
    </div>
  </div>

  <!-- Create Job Form -->
  <div class="create-job-form card">
    <div class="card-header">
      <h3>{{ 'jobs.createJob.information' | translate }}</h3>
    </div>
    <div class="card-body">
      <form [formGroup]="createJobForm" (ngSubmit)="onSubmit()" novalidate>
        <!-- Job Title -->
        <div class="form-group">
          <label for="jobTitle" class="form-label">
            {{ 'jobs.createJob.jobTitle.label' | translate }} <span class="text-danger">*</span>
          </label>
          <input
            type="text"
            id="jobTitle"
            class="form-control"
            formControlName="jobTitle"
            [class.is-invalid]="hasFieldError('jobTitle')"
            [placeholder]="'jobs.createJob.jobTitle.placeholder' | translate"
            maxlength="100"
          />
          <ng-container *ngIf="getFieldError('jobTitle') as jobTitleError">
            <div class="invalid-feedback">
              {{ jobTitleError.key | translate: jobTitleError.params }}
            </div>
          </ng-container>
          <div class="form-text">
            {{ 'jobs.createJob.jobTitle.hint' | translate }}
          </div>
        </div>

        <!-- Job Description -->
        <div class="form-group">
          <label for="jdText" class="form-label">
            {{ 'jobs.createJob.jobDescription.label' | translate }} <span class="text-danger">*</span>
          </label>
          <textarea
            id="jdText"
            class="form-control"
            formControlName="jdText"
            [class.is-invalid]="hasFieldError('jdText')"
            [placeholder]="'jobs.createJob.jobDescription.placeholder' | translate"
            rows="12"
            maxlength="5000"
          ></textarea>
          <ng-container *ngIf="getFieldError('jdText') as jdTextError">
            <div class="invalid-feedback">
              {{ jdTextError.key | translate: jdTextError.params }}
            </div>
          </ng-container>
          <div class="form-text">
            <div class="mb-2">{{ 'jobs.createJob.jobDescription.hint' | translate }}</div>
            <ul class="requirements-list">
              <li>{{ 'jobs.createJob.jobDescription.requirements.skills' | translate }}</li>
              <li>{{ 'jobs.createJob.jobDescription.requirements.experience' | translate }}</li>
              <li>{{ 'jobs.createJob.jobDescription.requirements.education' | translate }}</li>
              <li>{{ 'jobs.createJob.jobDescription.requirements.other' | translate }}</li>
            </ul>
          </div>
          <div class="character-count">
            {{ jdText?.value?.length || 0 }} / 5000 {{ 'common.characters' | translate }}
          </div>
        </div>

        <!-- Form Actions -->
        <div class="form-actions">
          <button
            type="button"
            class="btn btn-secondary mr-3"
            (click)="onCancel()"
            [disabled]="creating$ | async"
          >
            {{ 'jobs.createJob.actions.cancel' | translate }}
          </button>
          <button
            type="submit"
            class="btn btn-primary"
            [disabled]="!createJobForm.valid || (creating$ | async)"
          >
            <span *ngIf="creating$ | async" class="spinner"></span>
            {{ (creating$ | async) ? ('jobs.createJob.actions.creating' | translate) : ('jobs.createJob.actions.create' | translate) }}
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Progress Tracking Section -->
  <div *ngIf="shouldShowProgress()" class="progress-tracking-container card">
    <div class="card-header">
      <h3>{{ 'jobs.createJob.progress.title' | translate }}</h3>
    </div>
    <div class="card-body">
      <!-- Progress Bar -->
      <div class="progress-section">
        <div class="progress-header">
          <span class="progress-label">{{ getCurrentStep() }}</span>
          <span class="progress-percentage">{{ getProgressPercentage() }}%</span>
        </div>
        <div class="progress-bar-container">
          <div 
            class="progress-bar" 
            [style.width.%]="getProgressPercentage()"
            [attr.aria-valuenow]="getProgressPercentage()"
            aria-valuemin="0"
            aria-valuemax="100"
            role="progressbar"
          ></div>
        </div>
      </div>

      <!-- Status Message -->
      <div class="status-section">
        <div class="status-message">
          <span class="status-icon">üîÑ</span>
          <span class="status-text">{{ getProgressMessage() }}</span>
        </div>
        
        <!-- Estimated Time Remaining -->
        <div *ngIf="getEstimatedTimeRemaining()" class="time-remaining">
          <span class="time-label">{{ 'jobs.createJob.progress.estimatedTimeRemaining' | translate }}</span>
          <span class="time-value">{{ getEstimatedTimeRemaining() }}</span>
        </div>
      </div>

      <!-- Progress Steps Indicator -->
      <div class="steps-indicator">
        <div class="step" 
             *ngFor="let step of getProgressSteps(); let i = index"
             [class.completed]="step.completed"
             [class.active]="step.active">
          <div class="step-number">{{ i + 1 }}</div>
          <div class="step-label">{{ step.label }}</div>
        </div>
      </div>
    </div>
  </div>
</div>
