#!/usr/bin/env sh
set -e

# Skip local CI for delete-only pushes.
delete_only=1
while read -r local_ref local_sha remote_ref remote_sha; do
  if [ "$local_sha" != "0000000000000000000000000000000000000000" ]; then
    delete_only=0
    break
  fi
done

if [ "$delete_only" -eq 1 ]; then
  echo "‚è≠Ô∏è  Skipping ci:local for delete-only push"
  exit 0
fi

echo "üöÄ Running pre-push CI checks..."

# Use affected to only test changed projects (faster)
npx nx affected -t lint typecheck test build --base=origin/main --head=HEAD --parallel=false

echo "‚úÖ Pre-push checks passed!"
