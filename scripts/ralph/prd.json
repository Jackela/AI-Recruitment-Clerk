{
  "id": "CODE-004",
  "title": "Comprehensive Code Quality Improvement (Optimized)",
  "description": "Fix ESLint/type issues, split large files, replace stubs, add tests, and documentation. Based on independent evaluation by 3 subagents.",
  "acceptanceCriteria": [
    "0 ESLint disable comments in production code",
    "All files < 500 lines",
    "0 any type usage",
    "80%+ test coverage for critical services",
    "All stubs replaced with real implementations",
    "Complete documentation for all modules",
    "npm run ci:full passes"
  ],
  "priority": 1,
  "branchName": "refactor/comprehensive-improvement",
  "subtasks": [
    {
      "id": "CLEAN-001",
      "title": "Fix any types in shared-dtos library",
      "description": "Remove all @typescript-eslint/no-explicit-any warnings in shared-dtos",
      "acceptanceCriteria": [
        "No @typescript-eslint/no-explicit-any in shared-dtos",
        "npm run lint for shared-dtos passes",
        "npm test passes"
      ],
      "priority": 1,
      "files": ["libs/shared-dtos/src/**/*.ts"],
      "passes": false
    },
    {
      "id": "CLEAN-002",
      "title": "Fix any types in app-gateway services",
      "description": "Remove all any types in app-gateway",
      "acceptanceCriteria": [
        "No any types in app-gateway",
        "npm run lint for app-gateway passes",
        "npm test passes"
      ],
      "priority": 1,
      "files": ["apps/app-gateway/src/**/*.ts"],
      "passes": false
    },
    {
      "id": "CLEAN-003",
      "title": "Fix any types in resume-parser-svc",
      "description": "Remove all any types in resume-parser-svc",
      "acceptanceCriteria": ["No any types in resume-parser-svc", "Tests pass"],
      "priority": 1,
      "files": ["apps/resume-parser-svc/src/**/*.ts"],
      "passes": false
    },
    {
      "id": "CLEAN-004",
      "title": "Fix any types in scoring-engine-svc",
      "description": "Remove all any types in scoring-engine-svc",
      "acceptanceCriteria": [
        "No any types in scoring-engine-svc",
        "Tests pass"
      ],
      "priority": 1,
      "files": ["apps/scoring-engine-svc/src/**/*.ts"],
      "passes": false
    },
    {
      "id": "CLEAN-005",
      "title": "Fix any types in frontend",
      "description": "Remove all any types in frontend",
      "acceptanceCriteria": ["No any types in frontend", "E2E tests pass"],
      "priority": 2,
      "files": ["apps/ai-recruitment-frontend/src/**/*.ts"],
      "passes": false
    },
    {
      "id": "CLEAN-006",
      "title": "Fix TypeScript warnings (TS7053, TS6138)",
      "description": "Fix 42 warnings related to index signatures and unused DI",
      "acceptanceCriteria": ["No TS7053 warnings", "No TS6138 warnings"],
      "priority": 2,
      "passes": false
    },
    {
      "id": "CLEAN-007",
      "title": "Remove unused imports and dead code",
      "description": "Clean up all unused imports and commented-out code blocks",
      "acceptanceCriteria": [
        "No unused imports warnings",
        "No commented-out code blocks"
      ],
      "priority": 2,
      "passes": false
    },
    {
      "id": "CLEAN-008",
      "title": "Fix remaining TypeScript warnings (TS6133, TS6196)",
      "description": "Fix 19 warnings related to unused variables and unused types",
      "acceptanceCriteria": ["No TS6133 warnings", "No TS6196 warnings"],
      "priority": 3,
      "passes": false
    },
    {
      "id": "SPLIT-001",
      "title": "Split incentive.dto.ts (1,152 lines)",
      "description": "Split incentive.dto.ts into modular files under 500 lines each",
      "acceptanceCriteria": [
        "All files under 500 lines",
        "Barrel export maintains backward compatibility",
        "npm test passes"
      ],
      "priority": 1,
      "dependsOn": ["CLEAN-001"],
      "passes": false
    },
    {
      "id": "SPLIT-002",
      "title": "Split jobs.service.ts (1,084 lines)",
      "description": "Split jobs.service.ts using facade pattern",
      "acceptanceCriteria": [
        "All files under 500 lines",
        "Facade pattern implemented",
        "Tests pass"
      ],
      "priority": 1,
      "dependsOn": ["CLEAN-002"],
      "passes": false
    },
    {
      "id": "SPLIT-003",
      "title": "Split parsing.service.ts (1,082 lines)",
      "description": "Split parsing.service.ts using orchestrator pattern",
      "acceptanceCriteria": [
        "All files under 500 lines",
        "Orchestrator pattern implemented",
        "Tests pass"
      ],
      "priority": 1,
      "dependsOn": ["CLEAN-003"],
      "passes": false
    },
    {
      "id": "SPLIT-004",
      "title": "Split scoring-confidence.service.ts (1,013 lines)",
      "description": "Split scoring-confidence.service.ts using facade pattern",
      "acceptanceCriteria": ["All files under 500 lines", "Tests pass"],
      "priority": 1,
      "dependsOn": ["CLEAN-004"],
      "passes": false
    },
    {
      "id": "SPLIT-005",
      "title": "Split usage-limit.controller.ts (1,000 lines)",
      "description": "Split usage-limit.controller.ts under 500 lines",
      "acceptanceCriteria": ["All files under 500 lines", "Tests pass"],
      "priority": 2,
      "dependsOn": ["CLEAN-002"],
      "passes": false
    },
    {
      "id": "SPLIT-006",
      "title": "Split experience-calculator.spec.ts (2,577 lines)",
      "description": "Split test files by category under 500 lines each",
      "acceptanceCriteria": [
        "Test files split by category",
        "All test files under 500 lines",
        "All tests pass"
      ],
      "priority": 2,
      "dependsOn": ["SPLIT-003"],
      "passes": false
    },
    {
      "id": "SPLIT-007",
      "title": "Split infrastructure-shared index.ts (1,090 lines)",
      "description": "Create modular exports for infrastructure-shared",
      "acceptanceCriteria": ["Modular exports", "Tests pass"],
      "priority": 2,
      "passes": false
    },
    {
      "id": "SPLIT-008",
      "title": "Split report.repository.ts (964 lines)",
      "description": "Split report.repository.ts under 500 lines",
      "acceptanceCriteria": ["File under 500 lines", "Tests pass"],
      "priority": 2,
      "passes": false
    },
    {
      "id": "SPLIT-009",
      "title": "Split validation.util.ts (979 lines)",
      "description": "Split into domain-specific validators",
      "acceptanceCriteria": ["Domain-specific validators", "Tests pass"],
      "priority": 2,
      "passes": false
    },
    {
      "id": "SPLIT-010",
      "title": "Split analytics.controller.ts (902 lines)",
      "description": "Consolidate analytics endpoints",
      "acceptanceCriteria": ["Consolidated analytics endpoints", "Tests pass"],
      "priority": 2,
      "passes": false
    },
    {
      "id": "STUB-001",
      "title": "Replace AI services stub with real implementation",
      "description": "Implement real Gemini API integration",
      "acceptanceCriteria": [
        "Real Gemini API integration",
        "Environment-based API key configuration",
        "Error handling implemented",
        "Integration tests added"
      ],
      "priority": 1,
      "dependsOn": ["CLEAN-001"],
      "risk": "HIGH - Requires external API keys",
      "passes": false
    },
    {
      "id": "STUB-002",
      "title": "Replace JD extractor stub",
      "description": "Implement real JD extraction logic with NATS event handling",
      "acceptanceCriteria": [
        "Real JD extraction logic",
        "NATS event handling",
        "Tests pass"
      ],
      "priority": 1,
      "dependsOn": ["CLEAN-003"],
      "passes": false
    },
    {
      "id": "STUB-003",
      "title": "Replace scoring engine stub",
      "description": "Implement real scoring algorithms with NATS integration",
      "acceptanceCriteria": [
        "Real scoring algorithms",
        "NATS integration",
        "Tests pass"
      ],
      "priority": 1,
      "dependsOn": ["CLEAN-004", "SPLIT-004"],
      "passes": false
    },
    {
      "id": "STUB-004",
      "title": "Replace resume parser NATS stub",
      "description": "Implement real parsing logic with NATS integration",
      "acceptanceCriteria": [
        "Real parsing logic",
        "NATS integration",
        "Tests pass"
      ],
      "priority": 1,
      "dependsOn": ["SPLIT-003"],
      "passes": false
    },
    {
      "id": "TEST-001",
      "title": "Add tests for field-mapper.service.ts",
      "description": "Add unit tests for field-mapper.service.ts with 80%+ coverage",
      "acceptanceCriteria": [
        "Unit tests added",
        "80%+ coverage for field-mapper.service.ts",
        "All tests pass"
      ],
      "priority": 1,
      "dependsOn": ["SPLIT-003"],
      "passes": false
    },
    {
      "id": "TEST-002",
      "title": "Add tests for resume.service.ts",
      "description": "Add unit tests for resume.service.ts with 80%+ coverage",
      "acceptanceCriteria": ["Unit tests added", "80%+ coverage"],
      "priority": 1,
      "dependsOn": ["SPLIT-002"],
      "passes": false
    },
    {
      "id": "TEST-003",
      "title": "Add integration tests for NATS communication",
      "description": "Add cross-service communication tests and event flow tests",
      "acceptanceCriteria": [
        "Cross-service communication tests",
        "Event flow tests",
        "All tests pass"
      ],
      "priority": 2,
      "dependsOn": ["STUB-001", "STUB-002", "STUB-003", "STUB-004"],
      "passes": false
    },
    {
      "id": "TEST-004",
      "title": "Add E2E tests for critical user flows",
      "description": "Add E2E tests for resume upload and analysis result viewing",
      "acceptanceCriteria": [
        "Resume upload flow tested",
        "Analysis result viewing tested",
        "All E2E tests pass"
      ],
      "priority": 2,
      "dependsOn": [
        "CLEAN-001",
        "CLEAN-002",
        "CLEAN-003",
        "CLEAN-004",
        "CLEAN-005",
        "SPLIT-001",
        "SPLIT-002",
        "SPLIT-003",
        "SPLIT-004",
        "STUB-001",
        "STUB-002",
        "STUB-003",
        "STUB-004"
      ],
      "passes": false
    },
    {
      "id": "DOC-001",
      "title": "Add README for all libs directories",
      "description": "Add README with library overview, usage examples, and API documentation for all 17 libs directories",
      "acceptanceCriteria": [
        "Library overview",
        "Usage examples",
        "API documentation"
      ],
      "priority": 2,
      "dependsOn": [
        "SPLIT-001",
        "SPLIT-002",
        "SPLIT-003",
        "SPLIT-004",
        "SPLIT-005",
        "SPLIT-006",
        "SPLIT-007",
        "SPLIT-008",
        "SPLIT-009",
        "SPLIT-010"
      ],
      "passes": false
    },
    {
      "id": "DOC-002",
      "title": "Add README for all apps directories",
      "description": "Add README with architecture overview, setup instructions, and API documentation for all apps",
      "acceptanceCriteria": [
        "Architecture overview",
        "Setup instructions",
        "API documentation"
      ],
      "priority": 2,
      "dependsOn": [
        "CLEAN-001",
        "CLEAN-002",
        "CLEAN-003",
        "CLEAN-004",
        "CLEAN-005",
        "SPLIT-001",
        "SPLIT-002",
        "SPLIT-003",
        "SPLIT-004",
        "SPLIT-005",
        "SPLIT-006",
        "SPLIT-007",
        "SPLIT-008",
        "SPLIT-009",
        "SPLIT-010",
        "STUB-001",
        "STUB-002",
        "STUB-003",
        "STUB-004",
        "TEST-001",
        "TEST-002",
        "TEST-003",
        "TEST-004"
      ],
      "passes": false
    }
  ]
}
