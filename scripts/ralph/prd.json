{
  "project": "AI-Recruitment-Clerk",
  "branchName": "ralph/repo-hygiene-ci",
  "description": "Refactor remaining items to align with best practices with smaller, verifiable steps.",
  "userStories": [
    {
      "id": "US-001",
      "title": "Introduce shared DTO validation pipe",
      "description": "As a maintainer, I want a single validation pipe used by controllers.",
      "acceptanceCriteria": [
        "Create shared validation pipe in libs/infrastructure-shared",
        "Pipe supports class-validator and class-transformer",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": "No behavior change expected."
    },
    {
      "id": "US-002",
      "title": "Apply validation pipe to app-gateway",
      "description": "As a maintainer, I want app-gateway controllers to use the shared pipe.",
      "acceptanceCriteria": [
        "Register pipe globally in app-gateway",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": "Do not modify DTOs."
    },
    {
      "id": "US-003",
      "title": "Apply validation pipe to one microservice",
      "description": "As a maintainer, I want at least one microservice to use the shared pipe.",
      "acceptanceCriteria": [
        "Register pipe in resume-parser-svc",
        "Typecheck passes"
      ],
      "priority": 3,
      "passes": true,
      "notes": "Choose smallest blast radius."
    },
    {
      "id": "US-004",
      "title": "Define shared API error DTO",
      "description": "As a consumer, I need a consistent error response shape.",
      "acceptanceCriteria": [
        "Add error-response.dto.ts in libs/shared-dtos",
        "Export from shared-dtos index",
        "Typecheck passes"
      ],
      "priority": 4,
      "passes": true,
      "notes": "Keep backward compatible fields."
    },
    {
      "id": "US-005",
      "title": "Align app-gateway error responses with shared DTO",
      "description": "As a consumer, I need app-gateway to return the shared error shape.",
      "acceptanceCriteria": [
        "Update global-exception.filter.ts to use shared DTO",
        "Typecheck passes"
      ],
      "priority": 5,
      "passes": true,
      "notes": "No change to status codes."
    },
    {
      "id": "US-006",
      "title": "Audit NATS services for base class usage",
      "description": "As a maintainer, I need a verified list of NATS services and their base class usage.",
      "acceptanceCriteria": [
        "Create docs/NATS_BASE_CLASS_AUDIT.md",
        "List each service and whether it uses BaseMicroserviceService"
      ],
      "priority": 6,
      "passes": true,
      "notes": "All 4 NATS services already use BaseMicroserviceService - no refactoring needed."
    },
    {
      "id": "US-007",
      "title": "Fix first NATS service not using base class",
      "description": "As a maintainer, I want the first non-compliant service aligned.",
      "acceptanceCriteria": [
        "Refactor one service to BaseMicroserviceService",
        "Add/update tests",
        "npm run test passes"
      ],
      "priority": 7,
      "passes": true,
      "notes": "N/A - All NATS services already compliant (see US-006 audit)."
    },
    {
      "id": "US-008",
      "title": "Normalize env access in app-gateway",
      "description": "As a maintainer, I want app-gateway to use env validator for config.",
      "acceptanceCriteria": [
        "Replace direct process.env usage in app-gateway config",
        "Typecheck passes"
      ],
      "priority": 8,
      "passes": true,
      "notes": "No new required envs. Added all app-gateway env vars to schema."
    },
    {
      "id": "US-009",
      "title": "Normalize env access in one microservice",
      "description": "As a maintainer, I want a microservice to use env validator.",
      "acceptanceCriteria": [
        "Replace direct process.env usage in resume-parser-svc",
        "Typecheck passes"
      ],
      "priority": 9,
      "passes": true,
      "notes": "Added getMongoUrl() helper for centralized env access."
    },
    {
      "id": "US-010",
      "title": "Add repository refactor checklist",
      "description": "As a maintainer, I need a refactor checklist to prevent regressions.",
      "acceptanceCriteria": [
        "Add docs/REFACTOR_CHECKLIST.md",
        "Include: lint, typecheck, test, build, e2e, contracts",
        "Typecheck passes"
      ],
      "priority": 10,
      "passes": true,
      "notes": "Created concise checklist with quick reference."
    },
    {
      "id": "US-011",
      "title": "Consolidate Jest setup file usage",
      "description": "As a maintainer, I want consistent jest setup across projects.",
      "acceptanceCriteria": [
        "Identify duplicate setup files",
        "Use one shared setup in jest.config.cjs",
        "npm run test passes"
      ],
      "priority": 11,
      "passes": false,
      "notes": "No behavior change."
    },
    {
      "id": "US-012",
      "title": "Verify config folder references",
      "description": "As a maintainer, I want all config references to use /config paths.",
      "acceptanceCriteria": [
        "Search and update stale paths",
        "npm run lint passes"
      ],
      "priority": 12,
      "passes": false,
      "notes": "Docs and scripts only."
    },
    {
      "id": "US-013",
      "title": "Introduce integration test pattern doc",
      "description": "As a maintainer, I want a standard integration test pattern.",
      "acceptanceCriteria": [
        "Add docs/TESTING_PATTERN.md",
        "Include folder structure and naming",
        "Typecheck passes"
      ],
      "priority": 13,
      "passes": false,
      "notes": "No code changes."
    },
    {
      "id": "US-014",
      "title": "Apply integration test pattern to one service",
      "description": "As a maintainer, I want one service aligned to the pattern.",
      "acceptanceCriteria": [
        "Refactor one service's integration tests",
        "npm run test passes"
      ],
      "priority": 14,
      "passes": false,
      "notes": "Pick a small service."
    },
    {
      "id": "US-015",
      "title": "Refactor shared DTOs structure (phase 1)",
      "description": "As a maintainer, I want shared DTOs grouped by domain.",
      "acceptanceCriteria": [
        "Create domain folders in libs/shared-dtos",
        "Move one domain's DTOs",
        "Update imports",
        "Typecheck passes"
      ],
      "priority": 15,
      "passes": false,
      "notes": "Incremental move only."
    },
    {
      "id": "US-016",
      "title": "Refactor shared DTOs structure (phase 2)",
      "description": "As a maintainer, I want remaining DTOs grouped by domain.",
      "acceptanceCriteria": [
        "Move remaining DTOs",
        "Update imports",
        "Typecheck passes"
      ],
      "priority": 16,
      "passes": false,
      "notes": "Complete the migration."
    },
    {
      "id": "US-017",
      "title": "Introduce shared logger wrapper",
      "description": "As ops, I need a consistent log format.",
      "acceptanceCriteria": [
        "Add logger wrapper in libs/infrastructure-shared",
        "Document usage in docs/LOGGING.md",
        "Typecheck passes"
      ],
      "priority": 17,
      "passes": false,
      "notes": "No external logging integration."
    },
    {
      "id": "US-018",
      "title": "Apply logger wrapper to one service",
      "description": "As ops, I want one service using the shared logger.",
      "acceptanceCriteria": [
        "Update app-gateway to use logger wrapper",
        "Typecheck passes"
      ],
      "priority": 18,
      "passes": false,
      "notes": "Keep log levels unchanged."
    },
    {
      "id": "US-019",
      "title": "Finalize refactor verification",
      "description": "As a maintainer, I need a full green local run before PR.",
      "acceptanceCriteria": [
        "npm run ci:local passes",
        "npm run test:e2e passes",
        "npm run validate:contracts:ci passes",
        "Document warnings in PR notes"
      ],
      "priority": 19,
      "passes": false,
      "notes": "Single PR only."
    }
  ]
}
