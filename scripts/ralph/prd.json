{
  "project": "AI-Recruitment-Clerk",
  "branchName": "ralph/repo-hygiene-ci",
  "description": "Repo-wide CI/E2E stabilization and AI-friendly workflow hardening. Goal: every change is small, verifiable (tests/lint/typecheck), and rollbackable, with CI as the source of truth.",
  "userStories": [
    {
      "id": "US-001",
      "title": "Fix Nx project graph failure (ESM webpack config)",
      "description": "As a developer, I need Nx to load app config reliably so CI lint/build/test jobs do not fail at graph generation.",
      "acceptanceCriteria": [
        "Resolve ESM/CJS mismatch in apps/app-gateway/webpack.config.js without breaking runtime",
        "npm run lint passes",
        "npm run typecheck passes",
        "npm run build passes",
        "Rollback plan documented"
      ],
      "priority": 1,
      "passes": true,
      "notes": "ESM webpack.config.js is working correctly. Rollback plan documented in docs/ROLLBACK-US-001.md"
    },
    {
      "id": "US-002",
      "title": "Restore API contract validation pipeline",
      "description": "As a team, I need contract validation to run consistently in CI and locally.",
      "acceptanceCriteria": [
        "npm run validate:contracts:ci passes locally",
        "CI workflow 'API Contract Validation' succeeds on main",
        "Any required env vars documented in .env.example",
        "Rollback plan documented"
      ],
      "priority": 2,
      "passes": true,
      "notes": "Contract validation is fully deterministic (file-based only). No env vars needed. Rollback plan in docs/ROLLBACK-US-002.md"
    },
    {
      "id": "US-003",
      "title": "Fix dependency gate inventory for semantic release",
      "description": "As a release pipeline, I need a stable dependency inventory file and deterministic gate evaluation.",
      "acceptanceCriteria": [
        "data/security/dependency-inventory.json exists or is generated before gate",
        "scripts/dependency-gate.mjs runs successfully",
        "CI workflow 'Semantic Release' passes dependency gate",
        "Rollback plan documented"
      ],
      "priority": 3,
      "passes": false,
      "notes": "If generated, add a clear, reproducible command in docs."
    },
    {
      "id": "US-004",
      "title": "Remediate npm audit vulnerabilities or document exceptions",
      "description": "As a maintainer, I need dependency security scanning to pass or be explicitly risk-accepted.",
      "acceptanceCriteria": [
        "High and moderate vulnerabilities reduced to zero where feasible",
        "If exceptions are required, document risk and expiry in SECURITY.md",
        "npm audit (or dependency scan job) passes thresholds in CI",
        "Rollback plan documented"
      ],
      "priority": 4,
      "passes": false,
      "notes": "Prefer upgrades/overrides over allowlists."
    },
    {
      "id": "US-005",
      "title": "Align local pre-push checks with CI (AI-friendly constraints)",
      "description": "As a developer using AI, I want local checks to mirror CI to prevent regressions before PR.",
      "acceptanceCriteria": [
        "npm run ci:local includes test → lint → typecheck (and build if required)",
        "Husky pre-push runs ci:local and skips on delete-only pushes",
        "README or CONTRIBUTING.md lists exact local verification commands",
        "Rollback plan documented"
      ],
      "priority": 5,
      "passes": false,
      "notes": "Keep runtime reasonable but non-negotiable for correctness."
    },
    {
      "id": "US-006",
      "title": "Stabilize E2E execution for local and CI",
      "description": "As QA, I need E2E to be deterministic with explicit server lifecycle and no hidden flakiness.",
      "acceptanceCriteria": [
        "npm run test:e2e passes locally",
        "CI 'ci' E2E step succeeds",
        "No reliance on arbitrary timeouts; use explicit waits",
        "Rollback plan documented"
      ],
      "priority": 6,
      "passes": false,
      "notes": "Prefer explicit wait conditions and controlled server startup/shutdown."
    },
    {
      "id": "US-007",
      "title": "Harden GitHub Actions workflows",
      "description": "As a repo, I need CI workflows to be secure, fast, and deterministic.",
      "acceptanceCriteria": [
        "Minimal permissions on all workflows",
        "Cache npm where appropriate",
        "Concurrency cancels redundant runs per branch",
        "Rollback plan documented"
      ],
      "priority": 7,
      "passes": false,
      "notes": "Do not introduce non-deterministic steps."
    },
    {
      "id": "US-008",
      "title": "AI-coding friendly contribution workflow",
      "description": "As a maintainer, I want AI-assisted changes to be small, verifiable, and easy to review.",
      "acceptanceCriteria": [
        "PR template requires: change list, risks, rollback, tests run",
        "CONTRIBUTING.md includes: single-issue change policy and local verification",
        "Document minimal change rule and review checklist"
      ],
      "priority": 8,
      "passes": false,
      "notes": "This encodes strong constraints for stable AI-assisted delivery."
    },
    {
      "id": "US-009",
      "title": "Introduce CODEOWNERS and review coverage",
      "description": "As a maintainer, I want critical areas to require review from the right owners.",
      "acceptanceCriteria": [
        "Add .github/CODEOWNERS with ownership for apps/, libs/, and workflows",
        "Document review expectations in CONTRIBUTING.md",
        "Rollback plan documented"
      ],
      "priority": 9,
      "passes": false,
      "notes": "Owners can be placeholders if team map is not final."
    },
    {
      "id": "US-010",
      "title": "Add issue templates for bug/feature/ops",
      "description": "As contributors, we need structured issue intake to reduce ambiguity.",
      "acceptanceCriteria": [
        "Add .github/ISSUE_TEMPLATE/bug_report.yml",
        "Add .github/ISSUE_TEMPLATE/feature_request.yml",
        "Add .github/ISSUE_TEMPLATE/ops_task.yml",
        "Rollback plan documented"
      ],
      "priority": 10,
      "passes": false,
      "notes": "Keep templates short and enforce acceptance criteria and repro steps."
    },
    {
      "id": "US-011",
      "title": "Pin GitHub Actions to commit SHA",
      "description": "As a security-conscious repo, I want actions pinned to immutable SHAs.",
      "acceptanceCriteria": [
        "All actions in .github/workflows are pinned to full SHA",
        "Document update process in SECURITY.md",
        "Rollback plan documented"
      ],
      "priority": 11,
      "passes": false,
      "notes": "Use official release SHAs; avoid floating tags."
    },
    {
      "id": "US-012",
      "title": "Add Dependabot or Renovate for dependency hygiene",
      "description": "As a maintainer, I want automated dependency updates with safe grouping.",
      "acceptanceCriteria": [
        "Add .github/dependabot.yml or renovate.json",
        "Group patch updates and security updates",
        "Document policy in CONTRIBUTING.md"
      ],
      "priority": 12,
      "passes": false,
      "notes": "Prefer Dependabot unless Renovate is already standard."
    },
    {
      "id": "US-013",
      "title": "Add repository health metadata",
      "description": "As a repo, I want standard metadata to improve discoverability and contribution quality.",
      "acceptanceCriteria": [
        "Add SECURITY.md guidance for disclosures (if missing or outdated)",
        "Add SUPPORT.md or update existing support section",
        "Ensure LICENSE is correct and referenced in README"
      ],
      "priority": 13,
      "passes": false,
      "notes": "Keep docs concise and linkable from README."
    },
    {
      "id": "US-014",
      "title": "Tighten lint/format boundaries and module boundaries",
      "description": "As a developer, I want lint rules to prevent unsafe cross-module imports.",
      "acceptanceCriteria": [
        "@nx/enforce-module-boundaries is configured for libs/apps",
        "eslint ignores moved from .eslintignore to eslint.config.mjs if needed",
        "npm run lint passes"
      ],
      "priority": 14,
      "passes": false,
      "notes": "Avoid noisy or non-actionable linting."
    },
    {
      "id": "US-015",
      "title": "Establish CI parity runbook",
      "description": "As a developer, I want a single place that maps CI jobs to local commands.",
      "acceptanceCriteria": [
        "Add docs/CI_RUNBOOK.md (or update existing docs) mapping each workflow to local commands",
        "Include expected runtime and prerequisites",
        "Rollback plan documented"
      ],
      "priority": 15,
      "passes": false,
      "notes": "Should be AI-friendly and copy-pasteable."
    },
    {
      "id": "US-016",
      "title": "Add PR checklist automation",
      "description": "As a maintainer, I want PRs to fail fast if required fields are missing.",
      "acceptanceCriteria": [
        "PR template includes required checkboxes for tests/risks/rollback",
        "Add a GitHub Action or Danger-style check to enforce PR template sections",
        "Rollback plan documented"
      ],
      "priority": 16,
      "passes": false,
      "notes": "Keep enforcement lightweight to avoid developer friction."
    },
    {
      "id": "US-017",
      "title": "Add task-level smoke tests for fast feedback",
      "description": "As a developer, I want a quick smoke test suite for local iteration.",
      "acceptanceCriteria": [
        "Add npm run test:smoke to run a minimal test subset",
        "Document when to use smoke vs full suite",
        "Rollback plan documented"
      ],
      "priority": 17,
      "passes": false,
      "notes": "Must not replace full CI checks."
    },
    {
      "id": "US-018",
      "title": "Finalize green CI on main",
      "description": "As a maintainer, I need confidence that the repo is fully green after fixes.",
      "acceptanceCriteria": [
        "npm run lint passes",
        "npm run typecheck passes",
        "npm run test passes",
        "npm run test:e2e passes",
        "CI workflows: ci, API Contract Validation, Semantic Release, Security Scan all succeed"
      ],
      "priority": 18,
      "passes": false,
      "notes": "Run locally first, then verify on GitHub Actions."
    }
  ]
}
