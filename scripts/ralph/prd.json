{
  "project": "AI-Recruitment-Clerk",
  "branchName": "ralph/repo-hygiene-ci",
  "description": "Large-scale refactor to align the monorepo with best practices: clear module boundaries, consistent layering, smaller components/services, and predictable configuration/testing.",
  "userStories": [
    {
      "id": "US-001",
      "title": "Create architecture baseline doc",
      "description": "As a maintainer, I need a single source of truth for layers and dependency direction.",
      "acceptanceCriteria": [
        "Add docs/ARCHITECTURE_BASELINE.md defining layers and allowed dependencies",
        "Include a module boundary diagram (text or mermaid)",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": "Keep it short and enforceable."
    },
    {
      "id": "US-002",
      "title": "Tag all Nx projects for boundary rules",
      "description": "As a maintainer, I need consistent tags so module-boundary lint rules are enforceable.",
      "acceptanceCriteria": [
        "Add tags to every project in nx.json or project.json files",
        "Tags follow a documented convention (e.g., type:app, type:lib, layer:domain)",
        "npm run lint passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": "Do not change runtime behavior."
    },
    {
      "id": "US-003",
      "title": "Enforce module boundaries based on tags",
      "description": "As a maintainer, I want lint to block invalid layer dependencies.",
      "acceptanceCriteria": [
        "Update eslint.config.mjs enforce-module-boundaries rules using tags",
        "Add at least 3 explicit forbidden dependency rules",
        "npm run lint passes"
      ],
      "priority": 3,
      "passes": true,
      "notes": "Avoid false positives; keep rules minimal."
    },
    {
      "id": "US-004",
      "title": "Standardize app entrypoints",
      "description": "As a maintainer, I want consistent bootstrapping and error handling across services.",
      "acceptanceCriteria": [
        "Refactor all main.ts files to use a shared bootstrap helper",
        "Add shared bootstrap helper in libs/infrastructure-shared",
        "Typecheck passes"
      ],
      "priority": 4,
      "passes": true,
      "notes": "No behavior changes, only consolidation."
    },
    {
      "id": "US-005",
      "title": "Introduce consistent error handling layer",
      "description": "As a maintainer, I want consistent error mapping and logging across services.",
      "acceptanceCriteria": [
        "Add shared error-handling utilities and use them in app-gateway",
        "Document usage in docs/ERROR_HANDLING.md",
        "Typecheck passes"
      ],
      "priority": 5,
      "passes": true,
      "notes": "Prefer non-breaking changes."
    },
    {
      "id": "US-006",
      "title": "Split oversized Angular components (phase 1)",
      "description": "As a frontend maintainer, I need components under size limits for maintainability.",
      "acceptanceCriteria": [
        "Identify top 3 largest components and split into presentational + container",
        "Each new component under 500 lines",
        "Typecheck passes",
        "npm run lint passes"
      ],
      "priority": 6,
      "passes": true,
      "notes": "Update tests if needed."
    },
    {
      "id": "US-007",
      "title": "Extract service business logic into dedicated services (phase 1)",
      "description": "As a backend maintainer, I want services to be thin orchestrators.",
      "acceptanceCriteria": [
        "Select 2 services with heavy logic and extract into new helper services",
        "Add unit tests for new helper services",
        "npm run test passes"
      ],
      "priority": 7,
      "passes": true,
      "notes": "No external behavior changes."
    },
    {
      "id": "US-008",
      "title": "Standardize DTO validation",
      "description": "As a maintainer, I want consistent validation across controllers.",
      "acceptanceCriteria": [
        "Introduce shared validation pipe or utility",
        "Apply to app-gateway controllers",
        "Typecheck passes"
      ],
      "priority": 8,
      "passes": false,
      "notes": "Must not break existing endpoints."
    },
    {
      "id": "US-009",
      "title": "Refactor NATS base class usage audit",
      "description": "As a maintainer, I want all NATS services to follow the base class convention.",
      "acceptanceCriteria": [
        "Audit all NATS services and align with BaseMicroserviceService",
        "Add missing tests if any service lacks coverage",
        "npm run test passes"
      ],
      "priority": 9,
      "passes": false,
      "notes": "Document deviations if needed."
    },
    {
      "id": "US-010",
      "title": "Normalize environment variable access",
      "description": "As a maintainer, I want all services to use shared env accessors.",
      "acceptanceCriteria": [
        "Replace direct process.env access in 2 services with env validator",
        "Update .env.example accordingly",
        "Typecheck passes"
      ],
      "priority": 10,
      "passes": false,
      "notes": "Incrementally migrate services."
    },
    {
      "id": "US-011",
      "title": "Add repository refactor checklist",
      "description": "As a maintainer, I need a checklist to prevent refactor regressions.",
      "acceptanceCriteria": [
        "Add docs/REFACTOR_CHECKLIST.md",
        "Include: tests, lint, typecheck, build, e2e, contracts",
        "Typecheck passes"
      ],
      "priority": 11,
      "passes": false,
      "notes": "Use the same order as ci:local."
    },
    {
      "id": "US-012",
      "title": "Consolidate test configuration",
      "description": "As a maintainer, I want consistent Jest setup across apps/libs.",
      "acceptanceCriteria": [
        "Remove duplicate jest setup files if any",
        "Ensure all projects use jest.config.cjs and shared setup",
        "npm run test passes"
      ],
      "priority": 12,
      "passes": false,
      "notes": "No change to test behavior."
    },
    {
      "id": "US-013",
      "title": "Refactor configuration folders layout",
      "description": "As a maintainer, I want configs grouped under /config with predictable paths.",
      "acceptanceCriteria": [
        "Ensure docker/deployment/env templates live under /config",
        "Update all references in docs and scripts",
        "npm run lint passes"
      ],
      "priority": 13,
      "passes": false,
      "notes": "Avoid breaking scripts."
    },
    {
      "id": "US-014",
      "title": "Define API error response shape",
      "description": "As a consumer, I need consistent error responses.",
      "acceptanceCriteria": [
        "Define shared error DTO in libs/shared-dtos",
        "Update app-gateway to return the shared shape",
        "Typecheck passes"
      ],
      "priority": 14,
      "passes": false,
      "notes": "Keep backward compatibility where possible."
    },
    {
      "id": "US-015",
      "title": "Introduce service-level integration test pattern",
      "description": "As a maintainer, I want a standard integration test structure.",
      "acceptanceCriteria": [
        "Add docs/TESTING_PATTERN.md",
        "Refactor one service's integration tests to match the pattern",
        "npm run test passes"
      ],
      "priority": 15,
      "passes": false,
      "notes": "Choose a small service first."
    },
    {
      "id": "US-016",
      "title": "Refactor shared DTOs organization",
      "description": "As a maintainer, I want shared DTOs grouped by domain.",
      "acceptanceCriteria": [
        "Reorganize libs/shared-dtos by domain folders",
        "Update all imports",
        "Typecheck passes"
      ],
      "priority": 16,
      "passes": false,
      "notes": "Avoid breaking public exports."
    },
    {
      "id": "US-017",
      "title": "Standardize logging format",
      "description": "As ops, I need consistent logs across services.",
      "acceptanceCriteria": [
        "Introduce a shared logger wrapper",
        "Apply to 2 services",
        "Typecheck passes"
      ],
      "priority": 17,
      "passes": false,
      "notes": "Keep current log levels."
    },
    {
      "id": "US-018",
      "title": "Finalize refactor verification",
      "description": "As a maintainer, I need a full green local run before PR.",
      "acceptanceCriteria": [
        "npm run ci:local passes",
        "npm run test:e2e passes",
        "npm run validate:contracts:ci passes",
        "Document warnings in PR notes"
      ],
      "priority": 18,
      "passes": false,
      "notes": "Single PR only."
    }
  ]
}
