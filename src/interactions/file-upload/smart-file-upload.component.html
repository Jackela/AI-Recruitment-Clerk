<div class="smart-file-upload">
  <!-- Drop Zone -->
  <div 
    #dropZone
    class="drop-zone"
    [class.disabled]="disabled"
    [class.drag-over]="isDragOver"
    [@dragEnter]="dragState"
    (click)="triggerFileSelect()">
    
    <div class="drop-zone-content">
      <div class="upload-icon">
        <svg *ngIf="!isProcessing" viewBox="0 0 24 24" class="icon-upload">
          <path fill="currentColor" d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
        </svg>
        
        <svg *ngIf="isProcessing" viewBox="0 0 24 24" class="icon-processing" [@pulse]="'processing'">
          <path fill="currentColor" d="M12,4V2A10,10 0 0,0 2,12H4A8,8 0 0,1 12,4Z"/>
        </svg>
      </div>

      <div class="upload-text">
        <h3 *ngIf="!isProcessing">{{ dragState === 'active' ? 'Drop files here' : 'Upload Files' }}</h3>
        <h3 *ngIf="isProcessing">Processing {{ fileQueue.value.length }} files...</h3>
        
        <p *ngIf="!isProcessing" class="upload-subtitle">
          Drag & drop files or <span class="link-text">browse</span>
        </p>
        
        <div *ngIf="isProcessing" class="processing-info">
          <div class="progress-bar">
            <div 
              class="progress-fill" 
              [style.width.%]="totalProgress"
              [@progressFill]="totalProgress">
            </div>
          </div>
          <span class="progress-text">{{ totalProgress.toFixed(0) }}% complete</span>
        </div>
      </div>

      <div class="upload-hints" *ngIf="!isProcessing">
        <div class="file-types">
          <span>Supported:</span>
          <span class="type-list">{{ config.acceptedTypes.join(', ') }}</span>
        </div>
        <div class="file-limits">
          Max {{ config.maxFiles }} files, {{ formatFileSize(config.maxFileSize) }} each
        </div>
      </div>
    </div>

    <!-- Hidden file input -->
    <input 
      #fileInput
      type="file" 
      [multiple]="config.maxFiles > 1"
      [accept]="config.acceptedTypes.join(',')"
      [disabled]="disabled"
      (change)="onFileInputChange($event)"
      class="file-input">
  </div>

  <!-- Intelligent Suggestions -->
  <div class="suggestions-panel" *ngIf="suggestedActions.length > 0">
    <h4>Smart Suggestions</h4>
    <div class="suggestions-list">
      <button 
        *ngFor="let suggestion of suggestedActions" 
        class="suggestion-button"
        [class.high-confidence]="suggestion.confidence > 0.8"
        (click)="triggerFileSelect()">
        <span class="suggestion-text">{{ suggestion.action }}</span>
        <span class="confidence-badge">{{ (suggestion.confidence * 100).toFixed(0) }}%</span>
      </button>
    </div>
  </div>

  <!-- File Queue -->
  <div class="file-queue" *ngIf="hasFiles">
    <div class="queue-header">
      <h4>Files ({{ fileQueue.value.length }})</h4>
      <div class="queue-actions">
        <button 
          class="btn btn-secondary btn-sm"
          *ngIf="!isProcessing && fileQueue.value.some(f => f.status === 'pending')"
          (click)="startBatchProcessing()">
          Process All
        </button>
        <button 
          class="btn btn-outline btn-sm"
          (click)="clearAll()"
          [disabled]="isProcessing">
          Clear All
        </button>
      </div>
    </div>

    <div class="file-list">
      <div 
        *ngFor="let file of fileQueue.value; trackBy: trackByFileId" 
        class="file-item"
        [class.completed]="file.status === 'completed'"
        [class.error]="file.status === 'error'"
        [class.processing]="file.status === 'processing' || file.status === 'uploading'"
        [@fileEnter]>
        
        <!-- File Preview -->
        <div class="file-preview">
          <img 
            *ngIf="file.preview" 
            [src]="file.preview" 
            [alt]="file.name"
            class="preview-image">
          
          <div *ngIf="!file.preview" class="file-icon">
            <svg viewBox="0 0 24 24">
              <path fill="currentColor" d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
            </svg>
          </div>

          <!-- Category Badge -->
          <div class="category-badge" [class]="file.category">
            {{ file.category.replace('_', ' ') | titlecase }}
          </div>
        </div>

        <!-- File Info -->
        <div class="file-info">
          <div class="file-name" [title]="file.name">{{ file.name }}</div>
          <div class="file-meta">
            <span class="file-size">{{ formatFileSize(file.size) }}</span>
            <span class="file-type">{{ file.type }}</span>
          </div>

          <!-- Progress Bar -->
          <div class="file-progress" *ngIf="file.status !== 'pending' && file.status !== 'completed'">
            <div class="progress-track">
              <div 
                class="progress-bar-fill" 
                [style.width.%]="file.progress"
                [@progressFill]="file.progress">
              </div>
            </div>
            <span class="progress-label">{{ file.progress.toFixed(0) }}%</span>
          </div>

          <!-- Error Message -->
          <div class="error-message" *ngIf="file.error">
            <svg viewBox="0 0 24 24" class="error-icon">
              <path fill="currentColor" d="M12,2L13.09,8.26L22,9L13.09,9.74L12,16L10.91,9.74L2,9L10.91,8.26L12,2Z"/>
            </svg>
            {{ file.error }}
          </div>
        </div>

        <!-- File Status -->
        <div class="file-status">
          <!-- Pending -->
          <div *ngIf="file.status === 'pending'" class="status-icon pending">
            <svg viewBox="0 0 24 24">
              <path fill="currentColor" d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,6A1.5,1.5 0 0,1 13.5,7.5A1.5,1.5 0 0,1 12,9A1.5,1.5 0 0,1 10.5,7.5A1.5,1.5 0 0,1 12,6M12,20C9.79,20 7.79,19.1 6.34,17.66L17.66,6.34C19.1,7.79 20,9.79 20,12C20,16.41 16.41,20 12,20Z"/>
            </svg>
          </div>

          <!-- Processing -->
          <div *ngIf="file.status === 'uploading' || file.status === 'processing'" class="status-icon processing">
            <svg viewBox="0 0 24 24" class="spinner">
              <path fill="currentColor" d="M12,4V2A10,10 0 0,0 2,12H4A8,8 0 0,1 12,4Z"/>
            </svg>
          </div>

          <!-- Completed -->
          <div *ngIf="file.status === 'completed'" class="status-icon completed">
            <svg viewBox="0 0 24 24">
              <path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"/>
            </svg>
          </div>

          <!-- Error -->
          <div *ngIf="file.status === 'error'" class="status-icon error">
            <svg viewBox="0 0 24 24">
              <path fill="currentColor" d="M12,2C17.53,2 22,6.47 22,12C22,17.53 17.53,22 12,22C6.47,22 2,17.53 2,12C2,6.47 6.47,2 12,2M15.59,7L12,10.59L8.41,7L7,8.41L10.59,12L7,15.59L8.41,17L12,13.41L15.59,17L17,15.59L13.41,12L17,8.41L15.59,7Z"/>
            </svg>
          </div>
        </div>

        <!-- File Actions -->
        <div class="file-actions">
          <button 
            *ngIf="file.status === 'error'"
            class="btn btn-sm btn-primary"
            (click)="retryFile(file.id)"
            [disabled]="isProcessing">
            Retry
          </button>

          <button 
            class="btn btn-sm btn-outline"
            (click)="removeFile(file.id)"
            [disabled]="isProcessing && (file.status === 'uploading' || file.status === 'processing')"
            [attr.aria-label]="'Remove ' + file.name">
            <svg viewBox="0 0 24 24" class="icon-remove">
              <path fill="currentColor" d="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z"/>
            </svg>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Batch Summary -->
  <div class="batch-summary" *ngIf="hasFiles && !isProcessing">
    <div class="summary-stats">
      <div class="stat">
        <span class="stat-value">{{ completedFiles.length }}</span>
        <span class="stat-label">Completed</span>
      </div>
      <div class="stat" *ngIf="failedFiles.length > 0">
        <span class="stat-value error">{{ failedFiles.length }}</span>
        <span class="stat-label">Failed</span>
      </div>
      <div class="stat">
        <span class="stat-value">{{ fileQueue.value.length }}</span>
        <span class="stat-label">Total</span>
      </div>
    </div>

    <div class="summary-actions" *ngIf="completedFiles.length > 0">
      <button class="btn btn-primary" (click)="batchCompleted.emit(completedFiles)">
        Continue with {{ completedFiles.length }} files
      </button>
    </div>
  </div>
</div>